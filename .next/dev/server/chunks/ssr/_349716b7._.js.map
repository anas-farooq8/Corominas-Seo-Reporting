{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Corominas-Seo-Reporting-System/lib/actions/datasources.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { z } from \"zod\"\r\n\r\nconst datasourceSchema = z.object({\r\n  customer_id: z.string().uuid(),\r\n  type: z.enum([\"mangools\", \"gsc\", \"ga4\", \"gbp\"]),\r\n  name: z.string().min(1, \"Name is required\"),\r\n  config: z.record(z.any()).optional(),\r\n})\r\n\r\ntype DatasourceInput = z.infer<typeof datasourceSchema>\r\n\r\n/**\r\n * Create a new datasource for a customer\r\n */\r\nexport async function createDatasource(input: DatasourceInput) {\r\n  try {\r\n    const validated = datasourceSchema.parse(input)\r\n    const supabase = await createClient()\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"datasources\")\r\n      .insert([\r\n        {\r\n          ...validated,\r\n          config: validated.config || {},\r\n        },\r\n      ])\r\n      .select()\r\n      .single()\r\n\r\n    if (error) throw new Error(error.message)\r\n\r\n    revalidatePath(`/dashboard/customers/${validated.customer_id}`)\r\n    return { success: true, data }\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : \"Failed to create datasource\"\r\n    console.error(\"Create datasource error:\", error)\r\n    return { success: false, error: message }\r\n  }\r\n}\r\n\r\n/**\r\n * Update a datasource\r\n */\r\nexport async function updateDatasource(id: string, input: Partial<DatasourceInput>) {\r\n  try {\r\n    const validated = datasourceSchema.partial().parse(input)\r\n    const supabase = await createClient()\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"datasources\")\r\n      .update({ ...validated, updated_at: new Date().toISOString() })\r\n      .eq(\"id\", id)\r\n      .select()\r\n      .single()\r\n\r\n    if (error) throw new Error(error.message)\r\n\r\n    revalidatePath(\"/dashboard\")\r\n    return { success: true, data }\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : \"Failed to update datasource\"\r\n    console.error(\"Update datasource error:\", error)\r\n    return { success: false, error: message }\r\n  }\r\n}\r\n\r\n/**\r\n * Delete a datasource\r\n */\r\nexport async function deleteDatasource(id: string) {\r\n  try {\r\n    const supabase = await createClient()\r\n\r\n    // Soft delete by setting is_active to false\r\n    const { error } = await supabase.from(\"datasources\").update({ is_active: false }).eq(\"id\", id)\r\n\r\n    if (error) throw new Error(error.message)\r\n\r\n    revalidatePath(\"/dashboard\")\r\n    return { success: true }\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : \"Failed to delete datasource\"\r\n    console.error(\"Delete datasource error:\", error)\r\n    return { success: false, error: message }\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;AAEA;AACA;AACA;;;;;;AAEA,MAAM,mBAAmB,uKAAC,CAAC,MAAM,CAAC;IAChC,aAAa,uKAAC,CAAC,MAAM,GAAG,IAAI;IAC5B,MAAM,uKAAC,CAAC,IAAI,CAAC;QAAC;QAAY;QAAO;QAAO;KAAM;IAC9C,MAAM,uKAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACxB,QAAQ,uKAAC,CAAC,MAAM,CAAC,uKAAC,CAAC,GAAG,IAAI,QAAQ;AACpC;AAOO,eAAe,iBAAiB,KAAsB;IAC3D,IAAI;QACF,MAAM,YAAY,iBAAiB,KAAK,CAAC;QACzC,MAAM,WAAW,MAAM,IAAA,yIAAY;QAEnC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,eACL,MAAM,CAAC;YACN;gBACE,GAAG,SAAS;gBACZ,QAAQ,UAAU,MAAM,IAAI,CAAC;YAC/B;SACD,EACA,MAAM,GACN,MAAM;QAET,IAAI,OAAO,MAAM,IAAI,MAAM,MAAM,OAAO;QAExC,IAAA,+IAAc,EAAC,CAAC,qBAAqB,EAAE,UAAU,WAAW,EAAE;QAC9D,OAAO;YAAE,SAAS;YAAM;QAAK;IAC/B,EAAE,OAAO,OAAO;QACd,MAAM,UAAU,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACzD,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO;YAAE,SAAS;YAAO,OAAO;QAAQ;IAC1C;AACF;AAKO,eAAe,iBAAiB,EAAU,EAAE,KAA+B;IAChF,IAAI;QACF,MAAM,YAAY,iBAAiB,OAAO,GAAG,KAAK,CAAC;QACnD,MAAM,WAAW,MAAM,IAAA,yIAAY;QAEnC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,eACL,MAAM,CAAC;YAAE,GAAG,SAAS;YAAE,YAAY,IAAI,OAAO,WAAW;QAAG,GAC5D,EAAE,CAAC,MAAM,IACT,MAAM,GACN,MAAM;QAET,IAAI,OAAO,MAAM,IAAI,MAAM,MAAM,OAAO;QAExC,IAAA,+IAAc,EAAC;QACf,OAAO;YAAE,SAAS;YAAM;QAAK;IAC/B,EAAE,OAAO,OAAO;QACd,MAAM,UAAU,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACzD,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO;YAAE,SAAS;YAAO,OAAO;QAAQ;IAC1C;AACF;AAKO,eAAe,iBAAiB,EAAU;IAC/C,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,yIAAY;QAEnC,4CAA4C;QAC5C,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,eAAe,MAAM,CAAC;YAAE,WAAW;QAAM,GAAG,EAAE,CAAC,MAAM;QAE3F,IAAI,OAAO,MAAM,IAAI,MAAM,MAAM,OAAO;QAExC,IAAA,+IAAc,EAAC;QACf,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,MAAM,UAAU,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACzD,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO;YAAE,SAAS;YAAO,OAAO;QAAQ;IAC1C;AACF;;;IAxEsB;IA8BA;IA0BA;;AAxDA,+OAAA;AA8BA,+OAAA;AA0BA,+OAAA"}},
    {"offset": {"line": 114, "column": 0}, "map": {"version":3,"sources":["file:///D:/Corominas-Seo-Reporting-System/lib/mangools/api.ts"],"sourcesContent":["import type { MangoolsApiDomain } from \"@/lib/supabase/types\"\r\nimport { cache } from \"react\"\r\n\r\nconst MANGOOLS_API_BASE = \"https://api.mangools.com/v3\"\r\n\r\n/**\r\n * Fetch available domains from Mangools SERPWatcher API\r\n * Returns all tracked domains from the account\r\n */\r\nexport const fetchMangoolsDomains = cache(async (): Promise<MangoolsApiDomain[]> => {\r\n  const accessToken = process.env.MANGOOLS_X_ACCESS_TOKEN\r\n\r\n  if (!accessToken) {\r\n    throw new Error(\"MANGOOLS_X_ACCESS_TOKEN environment variable is not set\")\r\n  }\r\n\r\n  try {\r\n    const response = await fetch(`${MANGOOLS_API_BASE}/serpwatcher/trackings`, {\r\n      method: \"GET\",\r\n      headers: {\r\n        \"x-access-token\": accessToken,\r\n        \"Content-Type\": \"application/json\",\r\n        Accept: \"*/*\",\r\n      },\r\n      next: {\r\n        revalidate: 300, // Cache for 5 minutes\r\n      },\r\n    })\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text()\r\n      console.error(\"[Mangools API] Error response:\", errorText)\r\n      throw new Error(`Mangools API error: ${response.status} ${response.statusText}`)\r\n    }\r\n\r\n    const data = (await response.json()) as MangoolsApiDomain[]\r\n    \r\n    // Filter out deleted domains\r\n    const activeDomains = data.filter((domain) => !domain.is_deleted)\r\n    \r\n    return activeDomains\r\n  } catch (error) {\r\n    console.error(\"[Mangools API] Fetch failed:\", error)\r\n    throw error\r\n  }\r\n})\r\n\r\n/**\r\n * Parse Mangools domain data for storage\r\n * Extracts only the fields we need for our database\r\n */\r\nexport function parseMangoolsDomainForDb(domain: MangoolsApiDomain) {\r\n  return {\r\n    mangools_id: domain._id,\r\n    domain: domain.domain,\r\n    location_code: domain.location?.code ?? null,\r\n    location_label: domain.location?.label ?? null,\r\n    keywords_count: domain.count ?? 0,\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AACA;;AAEA,MAAM,oBAAoB;AAMnB,MAAM,uBAAuB,IAAA,8MAAK,EAAC;IACxC,MAAM,cAAc,QAAQ,GAAG,CAAC,uBAAuB;IAEvD,IAAI,CAAC,aAAa;QAChB,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,GAAG,kBAAkB,sBAAsB,CAAC,EAAE;YACzE,QAAQ;YACR,SAAS;gBACP,kBAAkB;gBAClB,gBAAgB;gBAChB,QAAQ;YACV;YACA,MAAM;gBACJ,YAAY;YACd;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,kCAAkC;YAChD,MAAM,IAAI,MAAM,CAAC,oBAAoB,EAAE,SAAS,MAAM,CAAC,CAAC,EAAE,SAAS,UAAU,EAAE;QACjF;QAEA,MAAM,OAAQ,MAAM,SAAS,IAAI;QAEjC,6BAA6B;QAC7B,MAAM,gBAAgB,KAAK,MAAM,CAAC,CAAC,SAAW,CAAC,OAAO,UAAU;QAEhE,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,MAAM;IACR;AACF;AAMO,SAAS,yBAAyB,MAAyB;IAChE,OAAO;QACL,aAAa,OAAO,GAAG;QACvB,QAAQ,OAAO,MAAM;QACrB,eAAe,OAAO,QAAQ,EAAE,QAAQ;QACxC,gBAAgB,OAAO,QAAQ,EAAE,SAAS;QAC1C,gBAAgB,OAAO,KAAK,IAAI;IAClC;AACF"}},
    {"offset": {"line": 167, "column": 0}, "map": {"version":3,"sources":["file:///D:/Corominas-Seo-Reporting-System/lib/actions/domains.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { parseMangoolsDomainForDb } from \"@/lib/mangools/api\"\r\nimport type { MangoolsApiDomain } from \"@/lib/supabase/types\"\r\n\r\n/**\r\n * Attach a Mangools domain to a datasource\r\n */\r\nexport async function attachMangoolsDomain(datasourceId: string, domain: MangoolsApiDomain) {\r\n  try {\r\n    const supabase = await createClient()\r\n\r\n    // Parse domain data for storage\r\n    const domainData = parseMangoolsDomainForDb(domain)\r\n\r\n    // Insert or update the domain\r\n    const { data: insertedDomain, error: domainError } = await supabase\r\n      .from(\"mangools_domains\")\r\n      .upsert(\r\n        {\r\n          datasource_id: datasourceId,\r\n          ...domainData,\r\n          is_active: true,\r\n        },\r\n        {\r\n          onConflict: \"datasource_id,mangools_id\",\r\n        }\r\n      )\r\n      .select()\r\n      .single()\r\n\r\n    if (domainError) throw new Error(domainError.message)\r\n\r\n    revalidatePath(\"/dashboard\")\r\n    return { success: true, data: insertedDomain }\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : \"Failed to attach domain\"\r\n    console.error(\"Attach domain error:\", error)\r\n    return { success: false, error: message }\r\n  }\r\n}\r\n\r\n/**\r\n * Detach a Mangools domain from a datasource\r\n * Soft delete by setting is_active to false\r\n */\r\nexport async function detachMangoolsDomain(domainId: string) {\r\n  try {\r\n    const supabase = await createClient()\r\n\r\n    const { error } = await supabase.from(\"mangools_domains\").update({ is_active: false }).eq(\"id\", domainId)\r\n\r\n    if (error) throw new Error(error.message)\r\n\r\n    revalidatePath(\"/dashboard\")\r\n    return { success: true }\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : \"Failed to detach domain\"\r\n    console.error(\"Detach domain error:\", error)\r\n    return { success: false, error: message }\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AACA;;;;;;AAMO,eAAe,qBAAqB,YAAoB,EAAE,MAAyB;IACxF,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,yIAAY;QAEnC,gCAAgC;QAChC,MAAM,aAAa,IAAA,kJAAwB,EAAC;QAE5C,8BAA8B;QAC9B,MAAM,EAAE,MAAM,cAAc,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SACxD,IAAI,CAAC,oBACL,MAAM,CACL;YACE,eAAe;YACf,GAAG,UAAU;YACb,WAAW;QACb,GACA;YACE,YAAY;QACd,GAED,MAAM,GACN,MAAM;QAET,IAAI,aAAa,MAAM,IAAI,MAAM,YAAY,OAAO;QAEpD,IAAA,+IAAc,EAAC;QACf,OAAO;YAAE,SAAS;YAAM,MAAM;QAAe;IAC/C,EAAE,OAAO,OAAO;QACd,MAAM,UAAU,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACzD,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO;YAAE,SAAS;YAAO,OAAO;QAAQ;IAC1C;AACF;AAMO,eAAe,qBAAqB,QAAgB;IACzD,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,yIAAY;QAEnC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,oBAAoB,MAAM,CAAC;YAAE,WAAW;QAAM,GAAG,EAAE,CAAC,MAAM;QAEhG,IAAI,OAAO,MAAM,IAAI,MAAM,MAAM,OAAO;QAExC,IAAA,+IAAc,EAAC;QACf,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,MAAM,UAAU,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACzD,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO;YAAE,SAAS;YAAO,OAAO;QAAQ;IAC1C;AACF;;;IArDsB;IAsCA;;AAtCA,+OAAA;AAsCA,+OAAA"}},
    {"offset": {"line": 241, "column": 0}, "map": {"version":3,"sources":["file:///D:/Corominas-Seo-Reporting-System/.next-internal/server/app/dashboard/customers/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {createDatasource as '4071b6eda7da4b33a9577a1d4bc37812d2284e22ec'} from 'ACTIONS_MODULE0'\nexport {deleteDatasource as '4035c1705a267770e321fea6d4df08af736f28114c'} from 'ACTIONS_MODULE0'\nexport {attachMangoolsDomain as '60cf7c1cbf82bc827a9941a9142a3090fe7e3ddb2b'} from 'ACTIONS_MODULE1'\nexport {detachMangoolsDomain as '401037ee78f3a565d7c195af2bc5e8ccf5392f5f9e'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AAEA"}}]
}
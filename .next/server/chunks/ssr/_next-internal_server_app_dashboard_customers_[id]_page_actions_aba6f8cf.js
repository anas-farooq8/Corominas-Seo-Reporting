module.exports=[21813,a=>{"use strict";var b=a.i(37936),c=a.i(98310),d=a.i(18558),e=a.i(83111),f=a.i(13095);let g=e.z.object({customer_id:e.z.string().uuid(),type:e.z.enum(["mangools","gsc","ga4","gbp"]),name:e.z.string().min(1,"Name is required"),config:e.z.record(e.z.any()).optional()});async function h(a){try{let b=g.parse(a),e=await (0,c.createClient)(),{data:f,error:h}=await e.from("datasources").insert([{...b,config:b.config||{}}]).select().single();if(h)throw Error(h.message);return(0,d.revalidatePath)(`/dashboard/customers/${b.customer_id}`),{success:!0,data:f}}catch(b){let a=b instanceof Error?b.message:"Failed to create datasource";return console.error("Create datasource error:",b),{success:!1,error:a}}}async function i(a,b){try{let e=g.partial().parse(b),f=await (0,c.createClient)(),{data:h,error:i}=await f.from("datasources").update({...e,updated_at:new Date().toISOString()}).eq("id",a).select().single();if(i)throw Error(i.message);return(0,d.revalidatePath)("/dashboard"),{success:!0,data:h}}catch(b){let a=b instanceof Error?b.message:"Failed to update datasource";return console.error("Update datasource error:",b),{success:!1,error:a}}}async function j(a){try{let b=await (0,c.createClient)(),{error:e}=await b.from("datasources").update({is_active:!1}).eq("id",a);if(e)throw Error(e.message);return(0,d.revalidatePath)("/dashboard"),{success:!0}}catch(b){let a=b instanceof Error?b.message:"Failed to delete datasource";return console.error("Delete datasource error:",b),{success:!1,error:a}}}async function k(a,b){try{let e=await (0,c.createClient)(),f={mangools_id:b._id,domain:b.domain,location_code:b.location?.code??null,location_label:b.location?.label??null,keywords_count:b.count??0},{data:g,error:h}=await e.from("mangools_domains").upsert({datasource_id:a,...f,is_active:!0},{onConflict:"datasource_id,mangools_id"}).select().single();if(h)throw Error(h.message);return(0,d.revalidatePath)("/dashboard"),{success:!0,data:g}}catch(b){let a=b instanceof Error?b.message:"Failed to attach domain";return console.error("Attach domain error:",b),{success:!1,error:a}}}async function l(a){try{let b=await (0,c.createClient)(),{error:e}=await b.from("mangools_domains").update({is_active:!1}).eq("id",a);if(e)throw Error(e.message);return(0,d.revalidatePath)("/dashboard"),{success:!0}}catch(b){let a=b instanceof Error?b.message:"Failed to detach domain";return console.error("Detach domain error:",b),{success:!1,error:a}}}(0,f.ensureServerEntryExports)([h,i,j]),(0,b.registerServerReference)(h,"40e3a88daf32878f27344fd2909c1a245c77d38fd1",null),(0,b.registerServerReference)(i,"601dc0a8e65e801fb5ddf534b046a4413851a1892f",null),(0,b.registerServerReference)(j,"4024f083b43494c2dc5e3a3509b128895079f28136",null),(0,a.i(717).cache)(async()=>{let a=process.env.MANGOOLS_X_ACCESS_TOKEN;if(!a)throw Error("MANGOOLS_X_ACCESS_TOKEN environment variable is not set");try{let b=await fetch("https://api.mangools.com/v3/serpwatcher/trackings",{method:"GET",headers:{"x-access-token":a,"Content-Type":"application/json",Accept:"*/*"},next:{revalidate:300}});if(!b.ok){let a=await b.text();throw console.error("[Mangools API] Error response:",a),Error(`Mangools API error: ${b.status} ${b.statusText}`)}return(await b.json()).filter(a=>!a.is_deleted)}catch(a){throw console.error("[Mangools API] Fetch failed:",a),a}}),(0,f.ensureServerEntryExports)([k,l]),(0,b.registerServerReference)(k,"60e966ffd89c2eb5b8e9848f460320db8a10dd5374",null),(0,b.registerServerReference)(l,"40f9270c98c1c2c35f8255fc5979c3687471cef6d1",null),a.s([],29256),a.i(29256),a.s(["4024f083b43494c2dc5e3a3509b128895079f28136",()=>j,"40e3a88daf32878f27344fd2909c1a245c77d38fd1",()=>h,"40f9270c98c1c2c35f8255fc5979c3687471cef6d1",()=>l,"60e966ffd89c2eb5b8e9848f460320db8a10dd5374",()=>k],21813)}];

//# sourceMappingURL=_next-internal_server_app_dashboard_customers_%5Bid%5D_page_actions_aba6f8cf.js.map